<html>
<head>
    <script src="http://d3js.org/d3.v3.min.js"></script>
    <!-- This library supports geographic data -->
    <script src="http://d3js.org/topojson.v1.min.js"></script>
</head>
<body>
        <!-- Leave a target where we'll add a map of the world -->
    <div id="map1" class="map"></div>
    <div id="map2" class="map"></div>
    <div id="map3" class="map"></div>
    <div id="map4" class="map"></div>
    <div id="map5" class="map"></div>
    <div id="map6" class="map"></div>
    <div id="map7" class="map"></div>
    <div id="map8" class="map"></div>
    
    <script>
    // Goal: Make a map of the world, with the US highlighted in blue.
    //  This is a simplification of http://bl.ocks.org/mbostock/4180634
    
    // The data file "world-50m.json" is here:
    //  http://mimno.infosci.cornell.edu/info3300/world-50m.json
    
    var width = 960,
        height = 500;

    // Projections are like scales. We'll use the trusty old Mercator.
    var projection = d3.geo.albersUsa();

    // This creates a function called path, that takes a sequence of 
    //  features and returns a string in SVG <path> language.
    var path = d3.geo.path()
        .projection(projection);
	function createMap(i){
    var svg = d3.select("#map" + i).append("svg")
        .attr("width", width)
        .attr("height", height);

    var mapData;

    var opacity = d3.scale.linear()
  		.domain([0,200000]).range([0,1]);

	
function calculateCrimeCount(file,type,decadeStart,decadeFinish,callback){
	/*
	return a hashtable of state:count 
	*/
	
	var stateCrimeCount = new Object();
	var crimeState;
	d3.csv(file, function (data) {
		
	    crimeState = data;
		crimeState.forEach(function(entry){
			if (entry.TypeCrime.trim() == type.trim() && entry.Year >= decadeStart && entry.Year <= decadeFinish){
				
				if (entry.State.toLowerCase() in stateCrimeCount){
					
					stateCrimeCount[entry.State.toLowerCase()] = Number(stateCrimeCount[entry.State.toLowerCase()]) + Number(entry.Count);
				}
				else{
					
					stateCrimeCount[entry.State.toLowerCase()] = entry.Count;
				}
				
			}	
			})
		callback(stateCrimeCount);
	  });
};


    // Draw the map of the 50 states
	calculateCrimeCount("CrimeStatebyState.csv","Violent Crime",1960,1969,function(stateCrimeCount){
	//called the callback function to use the counts when opening the us data.
    d3.json("us-name.json", function(error, us) {
        mapData = us;
        svg.append("g")
            .selectAll("path")
            .data(topojson.feature(us, us.objects.states).features)
            .enter()
            .append("path")
            .attr("d", path)
            .style("stroke", "black")
            .style("fill", "blue")
            .style("fill-opacity", function (d) {
            	return opacity(stateCrimeCount[d.properties.name.toLowerCase()]);
            })

    })});
}
	for (var i = 1; i < 9; i++) {
        createMap(i);
    }
   
    </script>
    
</body>
</html>











